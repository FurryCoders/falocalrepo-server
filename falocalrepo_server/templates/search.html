<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        body > h2 {
            text-align: center;
        }

        #search_form {
            width: 95%;
            top: 20px;
            margin: auto;
            text-align: center
        }

        #search_fields {
            width: 40%;
            top: 20px;
            margin: auto;
            text-align: left
        }

        td.col1 {
            width: 90px;
        }

        td.col2 {
            width: 150px;
        }

        td.col3 {
            width: 25px;
            text-align: center;
        }
    </style>
</head>
<body>
<h2>{{ title }}</h2>
<div id="search_form">
    <table id="search_fields">
        <tr>
            <td class="col1"><label for="search_field_type">New Field</label></td>
            <td class="col2"><select id="search_field_type" name="type" style="width: 100%;">
                <option selected value="{{ columns[0].lower() }}">{{ columns[0].title() }}</option>
                {% for col in columns[1:] %}
                    <option value="{{ col.lower() }}">{{ col.title() }}</option>
                {% endfor %}
                <option value="order">Order</option>
            </select></td>
            <td class="col3">
                <button onclick="addSearchField($('search_field_type').value)">+</button>
            </td>
        </tr>
    </table>
    <br>
    <button onclick="search()">Search</button>
</div>
<script>
    const $ = (id) => document.getElementById(id)
    const addSearchField = (fieldType) => {
        let parent = $("search_fields")

        let tr = document.createElement("tr")

        let td1 = document.createElement("td")
        let td2 = document.createElement("td")
        let td3 = document.createElement("td")

        td1.textContent = fieldType[0].toUpperCase() + fieldType.substring(1)
        td1.classList.add("col1")
        td2.classList.add("col2")
        td3.classList.add("col3")

        let fieldInput = document.createElement("input")
        fieldInput.type = "text"
        fieldInput.name = fieldType
        fieldInput.classList.add("search_field")
        fieldInput.style.width = "100%"

        let fieldRemove = document.createElement("button")
        fieldRemove.textContent = "-"
        fieldRemove.onclick = () => parent.removeChild(tr)

        td2.appendChild(fieldInput)
        td3.appendChild(fieldRemove)
        tr.appendChild(td1)
        tr.appendChild(td2)
        tr.appendChild(td3)
        parent.insertBefore(tr, parent.childNodes[parent.childElementCount - 1])

        return fieldInput
    }
    const search = () => {
        let params = {}
        Array.from(document.getElementsByClassName("search_field"))
            .forEach(f => {
                f.value = f.value.trim()
                if (f.value) params[f.name] = (params[f.name] || []).concat(f.value)
            });

        if (Object.keys(params).length === 0) return

        let url = new URL(window.location.href)
        url.pathname = "/search/{{ table }}"

        Object.entries(params)
            .forEach(([k, v]) => url.searchParams.set(k, JSON.stringify(v)))

        window.location = url.href
    }
    const params = {{ params|safe }};
    Object.entries(params).forEach(([k, vs]) => vs.forEach((v) => addSearchField(k).value = v))
</script>
</body>
</html>
