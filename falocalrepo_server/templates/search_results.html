<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        :root {
            --table_border_color: darkgray;
            --table_background_color_odd: white;
            --table_background_color_even: lightgrey;
        }

        body > h2 {
            text-align: center;
        }

        .header {
            width: 95%;
            top: 20px;
            margin: auto;
            text-align: center
        }

        .footer {
            width: 95%;
            top: 20px;
            margin: auto;
            text-align: center
        }

        .header table {
            width: 40%;
            top: 20px;
            margin: auto;
            text-align: left;
        }

        table {
            border-collapse: collapse;
            border: 1px solid var(--table_border_color);
        }

        table td {
            border: 1px solid var(--table_border_color);
        }

        table td span {
            padding: 2px;
        }

        table td:last-child {
            max-width: available !important;
        }

        table th {
            padding: 2px;
            border: 2px solid var(--table_border_color);
            text-align: center;
        }

        table .col_id {
            min-width: fit-content;
            text-align: center;
        }

        table .col_author {
            min-width: fit-content;
            text-align: center;
        }

        table .col_date {
            min-width: fit-content;
            text-align: center;
        }

        table .col_title {
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        table .col_tags {
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        table .col_description {
            max-width: 360px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        table tr.odd {
            background-image: linear-gradient(0deg, var(--table_background_color_odd), var(--table_background_color_odd));
        }

        table tr.even {
            background-image: linear-gradient(0deg, var(--table_background_color_even), var(--table_background_color_even));
        }

        #search_results {
            width: 95%;
            top: 20px;
            margin: auto;
        }

        button {
            position: relative;
            top: 10px;
            bottom: 10px;
        }

        .clickable {
            cursor: pointer;
        }

        .hover_highlight:hover {
            background-blend-mode: multiply;
            background-color: cyan;
        }

        .hover_underline:hover {
            text-decoration: underline;
        }

        td a.celllink {
            display: block;
            text-decoration: none;
            color: inherit;
        }
    </style>
</head>
<body>
{% set table_short %}{{ table[:-1] }}{% endset %}
<h2>{{ title }}</h2>
<div class="header">
    <table>
        {% for param, value in params.items() %}
            <tr class="{{ loop.cycle('odd', 'even') }}">
                <td style="width: 80px">{{ param.title() }}</td>
                <td>{{ " OR ".join(value) }}</td>
            </tr>
        {% endfor %}
    </table>
    <br>
    {% set navigation %}
    Results: {{ offset }}-{{ offset + results|length }} of {{ results_total }}
    Â· Page {{ (offset // limit) + 1 }}
    <br>
    <button onclick="pagePrev()" {{ 'disabled' if offset <= 0 }}>
        Prev
    </button>
    <button onclick="window.location = window.location.pathname">New Search</button>
    <button onclick="pageNext()" {{ 'disabled' if offset + results|length >= results_total }}>
        Next
    </button>
    {% endset %}
    {{ navigation }}
    <br>&nbsp;<br>
</div>
<table id="search_results">
    <tr class="even" style="text-align: center">
        {% for column in columns %}
            <th class="col_{{ column.lower() }} clickable hover_underline" onclick="sortBy('{{ column }}')">{{ column }}</th>
        {% endfor %}
    </tr>
    {% for item in results %}
        <tr class="hover_highlight clickable {{ loop.cycle('odd', 'even') }}">
            {% for column in columns %}
                <td class="col_{{ column.lower() }} {{ 'hover_underline' if column == "AUTHOR" }}">
                    {% if column == "AUTHOR" %}
                        <a class="celllink" href="/user/{{ item[column] }}">
                            <span>{{ item[column] }}</span>
                        </a>
                    {% else %}
                        <a class="celllink" href="/{{ table_short }}/{{ item[column_id] }}">
                            <span>{{ " ".join(item[column].split(",")) if column in columns_list else item[column] }}</span>
                        </a>
                    {% endif %}
                </td>
            {% endfor %}
        </tr>
    {% endfor %}
</table>
<br>
<div class="footer">
    {{ navigation }}
    <br>&nbsp;<br>
</div>
<script>
    const sortBy = (sortField) => {
        let url = new URL(window.location.href)
        url.searchParams.set("order", JSON.stringify([sortField.toUpperCase()]))
        window.location = url.href
    }
    const pagePrev = () => {
        let url = new URL(window.location.href)
        let offset = Number(url.searchParams.get("offset") || 0)
        url.searchParams.set("offset", offset - {{ limit }} > 0 ? offset - {{ limit }} : 0)
        window.location = url.href
    }
    const pageNext = () => {
        let url = new URL(window.location.href)
        url.searchParams.set("offset", Number(url.searchParams.get("offset") || 0) + {{ limit }})
        window.location = url.href
    }
</script>
</body>
</html>